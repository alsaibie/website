---
import { getRelativeLocaleUrl } from "astro:i18n";

const currentLocale = Astro.currentLocale || "en";
const currentPath = Astro.url.pathname;

// Remove locale prefix from path to get the base path
const basePath = currentPath.replace(/^\/(ar|en)/, '') || '/';

const otherLanguage = currentLocale === "en" ? "ar" : "en";
const otherLanguageCode = currentLocale === "en" ? "Ar" : "En";
const switchUrl = getRelativeLocaleUrl(otherLanguage, basePath);
---

<div class="language-switcher">
  <button 
    id="language-toggle"
    class="flex items-center rounded-sm border border-black/15 bg-neutral-100 px-2 py-1 text-xs transition-colors duration-300 ease-in-out hover:bg-black/5 hover:text-black focus-visible:bg-black/5 focus-visible:text-black dark:border-white/20 dark:bg-neutral-900 dark:hover:bg-white/5 dark:hover:text-white dark:focus-visible:bg-white/5 dark:focus-visible:text-white"
    aria-label={`Switch to ${otherLanguage === "ar" ? "Arabic" : "English"}`}
    title={`Switch to ${otherLanguage === "ar" ? "Arabic" : "English"}`}
    data-url={switchUrl}
  >
    {otherLanguageCode}
  </button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const button = document.getElementById('language-toggle') as HTMLButtonElement;
    if (button) {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        const url = button.getAttribute('data-url');
        if (url) {
          window.location.href = url;
        }
      });
    }
  });
</script>
